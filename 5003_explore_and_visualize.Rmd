---
title: "5003-explore and visualize"
author: "Tianyi"
date: "2025-09-17"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
# Load required packages
library(dplyr)
library(tidyr)
library(ggplot2)
library(naniar)
library(factoextra)
```

# 4. Explore and Visualize

In this section, we explore the dataset visually to better understand its key properties.  
We check for outliers, missing values, and use both univariate and multivariate plots.

```{r load-cleaned-data, echo=FALSE}
# Load cleaned dataset
listings_clean <- read.csv("cleaned_data.csv")
```

## 4.1 Outliers
```{r outliers, echo=FALSE, fig.width=6, fig.height=4}
# Boxplot for selected numerical variables to check outliers
numeric_vars <- c("price", "minimum_nights", "number_of_reviews")

listings_clean %>%
  select(all_of(numeric_vars)) %>%
  pivot_longer(cols = everything(), names_to = "variable", values_to = "value") %>%
  ggplot(aes(x = variable, y = value)) + 
  geom_boxplot(outlier.colour = "red", outlier.size = 1.5, fill = "skyblue") +
  scale_y_continuous(trans = "log10") +
  labs(title = "Boxplots of Selected Variables (log scale)",
       x = "Variable",
       y = "Value (log10 scale)") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5))
```

The boxplots confirm strong outliers in both price and minimum_nights. For example, minimum_nights ranges from 1 to 365 days, with a median of only 2, showing unrealistic long stays.

## 4.2 Missing Values
```{r missing-values, echo=FALSE, fig.width=6, fig.height=4}
# Visualize missing values
naniar::gg_miss_var(listings_clean) +
  labs(title = "Percentage of Missing Values by Variable",
       x = "Variable",
       y = "Missing (%)") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.y = element_text(size = 7))  
```

Missing values mainly occur in room-related variables such as beds (≈11%), bedrooms (≈4.5%), and bathrooms (≈2.2%). Core features like price, minimum_nights, and number_of_reviews are almost complete.

## 4.3 PCA for Dimensionality Reduction
```{r pca-plot, echo=FALSE, fig.width=6, fig.height=4}
selected_vars <- c("price", "minimum_nights", "number_of_reviews", 
                   "accommodates", "beds", "bedrooms")

numeric_data <- listings_clean %>%
  select(all_of(selected_vars)) %>%
  na.omit()

# Remove zero-variance columns
numeric_data <- numeric_data[, apply(numeric_data, 2, sd) != 0]

# Standardize and run PCA
pca_result <- prcomp(scale(numeric_data), scale. = TRUE)

# Plot PCA biplot with improved clarity
factoextra::fviz_pca_biplot(pca_result,
                            geom.ind = "point",
                            pointshape = 21,
                            fill.ind = "lightblue",
                            alpha.ind = 0.4,      # make points semi-transparent
                            col.var = "red",
                            repel = TRUE) +
  labs(title = "PCA Biplot of Key Numerical Features") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5))
```

The PCA shows that the first two principal components explain about 29% of the variance. Price and minimum_nights load strongly on one axis, while accommodates, beds, and bedrooms cluster on another, with number_of_reviews pointing in a distinct direction. This highlights clear groupings among key features, though more dimensions are needed for full representation.

## 4.4 Distribution of Price
```{r histograms, echo=FALSE, fig.width=6, fig.height=4}
# Histogram and density estimation for price
ggplot(listings_clean, aes(x = price)) +
  geom_histogram(aes(y = after_stat(density)),
                 bins = 50, fill = "steelblue", color = "white") +
  geom_density(color = "darkred", linewidth = 1) +
  scale_x_continuous(trans = "log10") +
  labs(title = "Histogram and Density of Price (log scale)",
       x = "Price (log scale)", 
       y = "Frequency") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5))
```

The distribution of price is strongly right-skewed, with a median of about 203 and a few listings priced as high as 998. Most properties are in the low to mid range, with a long tail of expensive rentals.

## Summary of Findings

- **Outliers**: *Minimum_nights* has extreme values, with a maximum of 365 nights compared to a median of 2.  
- **Missing values**: *Beds* (11.2%), *bedrooms* (4.5%), and *bathrooms* (2.2%) contain the main missing data, while price and reviews are complete.  
- **PCA**: The first two components explain about 29% of variance. *Price* and *minimum_nights* load strongly on one axis, while *accommodates*, *beds*, and *bedrooms* cluster on another, with *number_of_reviews* pointing in a distinct direction.  
- **Price distribution**: *Price* is highly right-skewed (skewness ≈ 1.8), with most listings affordable but a few very expensive (up to 998).  

Overall, the dataset shows skewness, moderate missingness, and clear outliers, providing a solid basis for further modelling.

## Appendix 3: Histograms of All Numerical Variables

```{r appendix-histograms, echo=FALSE, fig.width=6, fig.height=4}
listings_clean %>%
  select(price, minimum_nights, number_of_reviews, accommodates, beds, bedrooms, bathrooms) %>%
  pivot_longer(cols = everything(), names_to = "variable", values_to = "value") %>%
  drop_na(value) %>%
  ggplot(aes(x = value)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "white") +
  facet_wrap(~ variable, scales = "free_x", ncol = 3) +
  labs(title = "Histograms of Core Numerical Variables",
       x = "Value", y = "Count") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5))
```

The histograms of core numerical variables show clear skewness. Price and minimum_nights are heavily right-skewed with long tails, while number_of_reviews also shows skew but with more balanced counts. Accommodates, beds, bedrooms, and bathrooms follow more compact distributions, though still with some unevenness. These patterns highlight which features may need transformation before modelling.

## Appendix 4: Bar Charts of Selected Categorical Variables
```{r appendix-barplots, echo=FALSE, fig.width=6, fig.height=4}
categorical_vars <- c("room_type", "instant_bookable")

listings_clean %>%
  mutate(instant_bookable = factor(instant_bookable,
                                   levels = c(0,1),
                                   labels = c("Not Instant", "Instant"))) %>%
  select(all_of(categorical_vars)) %>%
  pivot_longer(cols = everything(), names_to = "variable", values_to = "value") %>%
  ggplot(aes(x = value, fill = value)) +
  geom_bar(show.legend = FALSE) +
  facet_wrap(~ variable, scales = "free_x") +
  labs(title = "Bar Charts of Selected Categorical Variables",
       x = "Category", y = "Number of Listings") +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5))
```

The bar charts show that most listings are entire homes/apartments, while fewer are private or shared rooms. For booking type, around 6,200 listings are not instantly bookable, compared to about 2,700 that allow instant booking.