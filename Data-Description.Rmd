---
title: "Data Cleaning"
author: "mia"
date: "2025-09-10"
output: 
  html_document:
  toc: true
  df_print: default
---

```{r library setup, include=FALSE}
library(dplyr)
library(knitr)
library(purrr)
library(naniar)
library(ggplot2)
library(tidyverse)
library(janitor)
library(skimr)
library(caret)
library(gt)
```

```{r data import}
orig_data = read.csv("datasets/listings.csv")
dictionary = read.csv("datasets/InsideAirbnbDataDictionarylistings.csvdetailv4.3.csv")
```
# Describe the Data
## Data Source
The dataset used in this project is obtained from Inside Airbnb (https://insideairbnb.com), a mission-driven initiative founded by Murray Cox in 2015. Inside Airbnb provides publicly accessible datasets that document the impact of short-term rentals on residential communities worldwide. Inside Airbnb independently collects, cleans, and publishes Airbnb listing data through web scraping and civic technology tools. The project is supported by the Housing Justice Data Lab (a registered not-for-profit) and an advisory board consisting of academics, activists, urban planners, and community advocates. Its purpose is to empower policymakers, researchers, and communities with evidence to understand and regulate the role of short-term rentals in local housing markets.

## Data Description
```{r}
orig_dim <- dim(orig_data)
n_rows <- orig_dim[1]; n_cols <- orig_dim[2]

tibble(
  Instances = n_rows,
  Attributes = n_cols,
  `p >> n?` = ifelse(n_cols > n_rows, "YES (wide dataset)", "NO")
) |>
  gt() |>
  tab_header(title = md("Table 1. Dataset Dimensions")) |>
  fmt_integer(columns = c(Instances, Attributes)) |>
  cols_align(align = "center")
```

```{r}
type_counts <- tibble(
  Numeric   = sum(map_lgl(orig_data, is.numeric)),
  Integer   = sum(map_lgl(orig_data, is.integer)),
  Double    = sum(map_lgl(orig_data, is.double)),
  Factor    = sum(map_lgl(orig_data, is.factor)),
  Character = sum(map_lgl(orig_data, is.character)),
  Logical   = sum(map_lgl(orig_data, is.logical))
) |>
  pivot_longer(everything(), names_to = "Type", values_to = "Count")

type_counts |>
  gt() |>
  tab_header(title = md("Table 2. Variable Type Counts")) |>
  fmt_integer(columns = Count) |>
  cols_align(align = "center")
```

```{r}
cat_vars <- names(orig_data)[map_lgl(orig_data, ~is.factor(.x) || is.character(.x))]

cat_card <- map_dfr(cat_vars, \(v) {
  vals <- orig_data[[v]]
  tibble(
    variable = v,
    n_unique = n_distinct(vals, na.rm = TRUE),
    zero_variance = n_distinct(vals, na.rm = TRUE) <= 1
  )
}) |>
  arrange(desc(n_unique))

cat_summary <- cat_card |>
  summarise(
    `# Categorical Variables` = n(),
    `Min Categories` = min(n_unique, na.rm = TRUE),
    `Max Categories` = max(n_unique, na.rm = TRUE),
    `# Zero-variance` = sum(zero_variance)
  )

cat_summary |>
  gt() |>
  tab_header(title = md("Table 3. Summary of Categorical Variables")) |>
  fmt_integer(columns = everything()) |>
  cols_align(align = "center")
```

```{r}
high_card_threshold <- 100
cat_card |>
  filter(n_unique > high_card_threshold) |>
  arrange(desc(n_unique)) |>
  head(20) |>
  gt() |>
  tab_header(
    title = md(paste0("Table 4. High-cardinality Categorical Variables (>", high_card_threshold, " levels) â€“ Top 20"))
  ) |>
  fmt_integer(columns = n_unique) |>
  cols_label(variable = "Variable", n_unique = "Unique Levels", zero_variance = "Zero Var?") |>
  cols_align(align = "center")
```

```{r}
orig_dim = dim(orig_data)

dictionary_clean <- dictionary %>%
  select(Variable = 1, Description = 4)

description_table <- tibble(Variable = names(orig_data)) %>%
  mutate(Type = ifelse(sapply(orig_data, is.numeric), "Numeric", "Categorical"),
         Unique_Values = sapply(orig_data, function(x) n_distinct(x, na.rm = TRUE))) %>%
  left_join(dictionary_clean, by = "Variable") %>%
  select(Variable, Description, Type, Unique_Values)

n_numeric = sum(description_table$Type == "Numeric")
n_categorical = sum(description_table$Type == "Categorical")

categorical_range <- description_table %>%
  filter(Type == "Categorical") %>%
  summarise(`# Categorical Variables` = n(),
            `Min` = min(Unique_Values, na.rm = TRUE),
            `Max` = max(Unique_Values, na.rm = TRUE))

kable(categorical_range, caption = "Table 1: Summary of Categorical Variables")
```
The raw dataset consists of `r orig_dim[1]` instances (rows) and `r orig_dim[2]` attributes (columns), making it a wide dataset with substantially more variables than observations. Among these attributes, `r n_numeric` are numerical variables (e.g., continuous measurements), while `r n_categorical` are categorical variables (e.g., discrete or factor-type features). A complete listing of variables is provided in Appendix 1.

For the categorical variables, the number of distinct categories varies considerably. Some variables are binary, whereas others contain up to 
`r categorical_range$Max`.Categories unique values (for example, identifiers such as host_id). At the other extreme, certain categorical variables exhibit no variation (0 categories), suggesting redundancy or a lack of analytical value (see Table 1).

Overall, the dataset has a relatively low proportion of missing values: approximately `r round(mean(is.na(orig_data)) * 100, 2)`% of all cells are missing (Appendix 2). However, the missingness is unevenly distributed across variables, with some attributes showing much higher levels of absence. This uneven distribution of missing data is likely to influence decisions about imputation strategies and variable selection in subsequent preprocessing steps.

## Independent and Dependent Variables
Dependent variable: binary categorical variable indicating rental type. this variable contain two outcome which is commercial where there's always available, entire unit, multiple listings by host and  occasional where there's limited availability, host-occupied, fewer listings. Yet this metric it not in the raw data, we will construct it using availability_365, minimum_nights, host_total_listings_count and instant_bookable.

Independent Variables: host_id, host_listings_count, host_total_listings_count, calculated_host_listings_count_, host_is_superhost, host_identity_verified, host_response_time, host_response_rate, host_acceptance_rate, property_type, room_type, accommodates, bathrooms, bedrooms, beds, price, amenities,instant_bookable, availability_30, availability_60, availability_90, availability_365, minimum_nights, maximum_nights and variations, reviews_per_month, neighbourhood_cleansed, latitude, longitude, review_scores_rating, review_scores_cleanliness, review_scores_value

# Challenges

# Appendix
```{r, echo=FALSE}
kable(description_table, caption = "Appendix 1: Variable Description")
```
2. Missing Value
```{r figure x, fig.height= 12}
gg_miss_var(orig_data) +
  labs(title = "Appendix 2: Missing Values per Variable")
```